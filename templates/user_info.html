{% extends 'base.html' %}

{% block content %}
<h2>User Information</h2>
<table>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Role</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>
    {% for user in users %}
    <tr>
        <td>{{ user.id }}</td>
        <td>{{ user.name }}</td>
        <td>{{ user.role }}</td>
        <td>
            <form action="{{ url_for('update_status', user_id=user.id) }}" method="POST">
                <select 
                    name="status" 
                    class="status-dropdown" 
                    style="padding: 5px; border: none; border-radius: 4px;" 
                    onchange="this.form.submit()" 
                    data-initial-status="{{ user.status }}"
                >
                    <option value="Unavailable" {% if user.status == 'Unavailable' %}selected{% endif %}>Unavailable</option>
                    <option value="Available" {% if user.status == 'Available' %}selected{% endif %}>Available</option>
                    <option value="Busy" {% if user.status == 'Busy' %}selected{% endif %}>Busy</option>
                    <option value="On Call" {% if user.status == 'On Call' %}selected{% endif %}>On Scene</option>
                </select>
            </form>
        </td>
        <td>
            <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" style="display:inline;">
                <button type="submit" style="background-color: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                    Remove User
                </button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

<script>
    // Function to apply background color based on status
    function applyStatusStyles() {
        const dropdowns = document.querySelectorAll('.status-dropdown');
        dropdowns.forEach(dropdown => {
            const status = dropdown.value;
            updateDropdownColor(dropdown, status);

            // Change color dynamically on selection
            dropdown.addEventListener('change', (e) => {
                updateDropdownColor(e.target, e.target.value);
            });
        });
    }

    // Map statuses to colors
    function updateDropdownColor(dropdown, status) {
        const colors = {
            "Unavailable": "#f44336", // Red
            "Available": "#4CAF50",  // Green
            "Busy": "#FFA500",       // Orange
            "On Call": "#9C27B0"     // Purple
        };
        dropdown.style.backgroundColor = colors[status] || "white";
        dropdown.style.color = "white"; // Ensure text is readable
    }

    // Apply styles on page load
    document.addEventListener('DOMContentLoaded', applyStatusStyles);
</script>

{% endblock %}
